(function($, p){let q='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen" style="disply:none"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>'; let r='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div></div>'; let s='__DEFAULT'; let t=document.createElement('div'); let u=0; let v=function(a){this.options=$.extend(true, {id: '__MUI_PREVIEWIMAGE', zoom: true, header: '<span class="mui-preview-indicator"></span>', footer: ''}, a||{}); this.init(); this.initEvent()}; let w=v.prototype; w.init=function(){let a=this.options; let b=document.getElementById(this.options.id); if(!b){t.innerHTML=q.replace(/\{\{id\}\}/g, this.options.id).replace('{{header}}', a.header).replace('{{footer}}', a.footer); document.body.appendChild(t.firstElementChild); b=document.getElementById(this.options.id)}this.element=b; this.scroller=this.element.querySelector($.classSelector('.slider-group')); this.indicator=this.element.querySelector($.classSelector('.preview-indicator')); this.loader=this.element.querySelector($.classSelector('.preview-loading')); if(a.footer){this.element.querySelector($.classSelector('.preview-footer')).classList.remove($.className('hidden'))}this.addImages()}; w.initEvent=function(){let c=this; $(document.body).on('tap', 'img[data-preview-src]', function(){if(!(this.parentNode.nodeName==='A')){c.open(this)}return}); let d=null; var f=function(){!d&&(d=$.later(function(){c.loader.removeEventListener('tap', f); c.scroller.removeEventListener('tap', f); c.close()}, 300))}; this.scroller.addEventListener('doubletap', function(){if(d){d.cancel(); d=null}}); this.element.addEventListener('webkitAnimationEnd', function(){if(c.element.classList.contains($.className('preview-out'))){c.element.style.display='none'; c.element.classList.remove($.className('preview-out')); c.element.classList.remove($.className('preview-in')); d=null}else{c.loader.addEventListener('tap', f); c.scroller.addEventListener('tap', f)}}); this.element.addEventListener('slide', function(e){if(c.options.zoom){let a=c.element.querySelector('.mui-zoom-wrapper:nth-child('+(c.lastIndex+1)+')'); if(a){$(a).zoom().setZoom(1)}}let b=e.detail.slideNumber; c.lastIndex=b; c.indicator&&(c.indicator.innerText=(b+1)+'/'+c.currentGroup.length); c._loadItem(b)})}; w.addImages=function(a, b){this.groups={}; let c=[]; if(a){if(a===s){c=document.querySelectorAll('img[data-preview-src]:not([data-preview-group])')}else{c=document.querySelectorAll('img[data-preview-src][data-preview-group=\''+a+'\']')}}else{c=document.querySelectorAll('img[data-preview-src]')}if(c.length){for(let i=0, len=c.length; i<len; i++){this.addImage(c[i])}}}; w.addImage=function(a){let b=a.getAttribute('data-preview-group'); b=b||s; if(!this.groups[b]){this.groups[b]=[]}let c=a.getAttribute('src'); if(a.__mui_img_data&&a.__mui_img_data.src===c){this.groups[b].push(a.__mui_img_data)}else{let d=a.getAttribute('data-preview-src'); if(!d){d=c}let e={src: c, lazyload: c===d?'':d, loaded: c===d?true:false, sWidth: 0, sHeight: 0, sTop: 0, sLeft: 0, sScale: 1, el: a}; this.groups[b].push(e); a.__mui_img_data=e}}; w.empty=function(){this.scroller.innerHTML=''}; w._initImgData=function(a, b){if(!a.sWidth){let c=a.el; a.sWidth=c.offsetWidth; a.sHeight=c.offsetHeight; let d=$.offset(c); a.sTop=d.top; a.sLeft=d.left; a.sScale=Math.max(a.sWidth/p.innerWidth, a.sHeight/p.innerHeight)}b.style.webkitTransform='translate3d(0,0,0) scale('+a.sScale+')'}; w._getScale=function(a, b){let c=a.width/b.width; let d=a.height/b.height; let e=1; if(c<=d){e=a.height/(b.height*c)}else{e=a.width/(b.width*d)}return e}; w._imgTransitionEnd=function(e){let a=e.target; a.classList.remove($.className('transitioning')); a.removeEventListener('webkitTransitionEnd', this._imgTransitionEnd.bind(this))}; w._loadItem=function(a, b){let c=this.scroller.querySelector($.classSelector('.slider-item:nth-child('+(a+1)+')')); let d=this.currentGroup[a]; let e=c.querySelector('img'); this._initImgData(d, e); if(b){let f=this._getPosition(d); e.style.webkitTransitionDuration='0ms'; e.style.webkitTransform='translate3d('+f.x+'px,'+f.y+'px,0) scale('+d.sScale+')'; e.offsetHeight}if(!d.loaded&&e.getAttribute('data-preview-lazyload')){let g=this; g.loader.classList.add($.className('active')); e.style.webkitTransitionDuration='0.5s'; e.addEventListener('webkitTransitionEnd', g._imgTransitionEnd.bind(g)); e.style.webkitTransform='translate3d(0,0,0) scale('+d.sScale+')'; this.loadImage(e, function(){d.loaded=true; e.src=d.lazyload; g._initZoom(c, this.width, this.height); e.classList.add($.className('transitioning')); e.addEventListener('webkitTransitionEnd', g._imgTransitionEnd.bind(g)); e.setAttribute('style', ''); e.offsetHeight; g.loader.classList.remove($.className('active'))})}else{d.lazyload&&(e.src=d.lazyload); this._initZoom(c, e.width, e.height); e.classList.add($.className('transitioning')); e.addEventListener('webkitTransitionEnd', this._imgTransitionEnd.bind(this)); e.setAttribute('style', ''); e.offsetHeight}this._preloadItem(a+1); this._preloadItem(a-1)}; w._preloadItem=function(a){let b=this.scroller.querySelector($.classSelector('.slider-item:nth-child('+(a+1)+')')); if(b){let c=this.currentGroup[a]; if(!c.sWidth){let d=b.querySelector('img'); this._initImgData(c, d)}}}; w._initZoom=function(a, b, c){if(!this.options.zoom){return}if(a.getAttribute('data-zoomer')){return}let d=a.querySelector($.classSelector('.zoom')); if(d.tagName==='IMG'){let e=this; let f=e._getScale({width: a.offsetWidth, height: a.offsetHeight}, {width: b, height: c}); $(a).zoom({maxZoom: Math.max(f, 1)})}else{$(a).zoom()}}; w.loadImage=function(a, b){let c=function(){b&&b.call(this)}; let d=new Image(); d.onload=c; d.onerror=c; d.src=a.getAttribute('data-preview-lazyload')}; w.getRangeByIndex=function(a, b){return{from: 0, to: b-1}}; w._getPosition=function(a){let b=a.sLeft-p.pageXOffset; let c=a.sTop-p.pageYOffset; let d=(p.innerWidth-a.sWidth)/2; let e=(p.innerHeight-a.sHeight)/2; return{left: b, top: c, x: b-d, y: c-e}}; w.refresh=function(a, b){this.currentGroup=b; let c=b.length; let d=[]; let e=this.getRangeByIndex(a, c); let f=e.from; let g=e.to+1; let h=a; let j=''; let k=''; let l=p.innerWidth; let m=p.innerHeight; for(let i=0; f<g; f++, i++){let n=b[f]; let o=''; if(n.sWidth){o='-webkit-transform:translate3d(0,0,0) scale('+n.sScale+');transform:translate3d(0,0,0) scale('+n.sScale+')'}k=r.replace('{{src}}', n.src).replace('{{lazyload}}', n.lazyload).replace('{{style}}', o); if(f===a){h=i; j=$.className('active')}else{j=''}d.push(k.replace('{{className}}', j))}this.scroller.innerHTML=d.join(''); this.element.style.display='block'; this.element.classList.add($.className('preview-in')); this.lastIndex=h; this.element.offsetHeight; $(this.element).slider().gotoItem(h, 0); this.indicator&&(this.indicator.innerText=(h+1)+'/'+this.currentGroup.length); this._loadItem(h, true)}; w.openByGroup=function(a, b){a=Math.min(Math.max(0, a), this.groups[b].length-1); this.refresh(a, this.groups[b])}; w.open=function(a, b){if(this.isShown()){return}if(typeof a==='number'){b=b||s; this.addImages(b, a); this.openByGroup(a, b)}else{b=a.getAttribute('data-preview-group'); b=b||s; this.addImages(b, a); this.openByGroup(this.groups[b].indexOf(a.__mui_img_data), b)}}; w.close=function(a, b){if(!this.isShown()){return}this.element.classList.remove($.className('preview-in')); this.element.classList.add($.className('preview-out')); let c=this.scroller.querySelector($.classSelector('.slider-item:nth-child('+(this.lastIndex+1)+')')); let d=c.querySelector('img'); if(d){d.classList.add($.className('transitioning')); let e=this.currentGroup[this.lastIndex]; let f=this._getPosition(e); let g=f.left; let h=f.top; if(h>p.innerHeight||g>p.innerWidth||h<0||g<0){d.style.opacity=0; d.style.webkitTransitionDuration='0.5s'; d.style.webkitTransform='scale('+e.sScale+')'}else{if(this.options.zoom){$(d.parentNode.parentNode).zoom().toggleZoom(0)}d.style.webkitTransitionDuration='0.5s'; d.style.webkitTransform='translate3d('+f.x+'px,'+f.y+'px,0) scale('+e.sScale+')'}}let j=this.element.querySelectorAll($.classSelector('.zoom-wrapper')); for(let i=0, len=j.length; i<len; i++){$(j[i]).zoom().destroy()}$(this.element).slider().destroy()}; w.isShown=function(){return this.element.classList.contains($.className('preview-in'))}; let x=null; $.previewImage=function(a){if(!x){x=new v(a)}return x}; $.getPreviewImage=function(){return x}})(mui, window)